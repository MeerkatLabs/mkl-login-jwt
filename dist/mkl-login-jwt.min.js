/* 
   mkl-login-jwt 0.0.1 
*/

!function(a,b){b.module("mkl-login-jwt",["angular-jwt"]).config(["$httpProvider","jwtInterceptorProvider",function(a,b){b.tokenGetter=["JWTLoginService","config",function(a,b){return a.getJWT(b)}],a.interceptors.push("jwtInterceptor")}]);var c=function(a,c,d,e,f,g,h,i,j){var k=j.refreshTime,l=null,m=j.refreshUrl,n=j.loginUrl,o=j.ignoreUrls,p=!1,q="jwtToken",r={};r.login=function(b,c){return a({method:"POST",url:n,skipAuthorization:!0,data:{username:b,password:c}}).then(function(a){u(a.data.token),f.$broadcast(i.USER_LOGGED_IN)})};var s=function(){var a=d.invoke(j.displayLogin);return a},t=function(){d.invoke(j.hideLogin)};r.refreshToken=function(){return a({method:"POST",url:m,skipAuthorization:!0,data:{token:g.localStorage.getItem(q)}}).then(function(a){u(a.data.token)})["catch"](function(){return g.localStorage.removeItem("jwtToken"),c.cancel(l),r.getJWT()})},r.logout=function(){return e(function(a){g.localStorage.removeItem(q),c.cancel(l),l=null,f.$emit(i.USER_LOGGED_OUT),a()})},r.getJWT=function(a){if(b.isDefined(a)&&o(a))return"";var c=g.localStorage.getItem(q)||null;return null===c||"null"===c||"undefined"===c?(p=!0,s().then(function(){return g.localStorage.getItem(q)})["catch"](function(){return e.reject("Login cancelled")})):h.isTokenExpired(c)||null===l?r.refreshToken().then(function(){return g.localStorage.getItem(q)}):c};var u=function(a){g.localStorage.setItem(q,a),null===l&&(l=c(function(){r.refreshToken()},k)),p&&(t(),p=!1)};return r},d=function(){var a=this;this.refreshTime=25e4,this.refreshUrl="",this.loginUrl="",this.ignoreUrls=function(){return!1},this.displayLogin=["$q",function(a){return a.reject("Undefined display login method")}],this.hideLogin=["$q",function(a){return a.reject("Undefined hide login method")}],this.$get=["$http","$interval","$injector","$q","$rootScope","$window","jwtHelper","LOGIN_EVENTS",function(b,d,e,f,g,h,i,j){var k={refreshTime:a.refreshTime,refreshUrl:a.refreshUrl,loginUrl:a.loginUrl,ignoreUrls:a.ignoreUrls,displayLogin:a.displayLogin,hideLogin:a.hideLogin};return new c(b,d,e,f,g,h,i,j,k)}]};b.module("mkl-login-jwt").provider("JWTLoginService",d).constant("LOGIN_EVENTS",{USER_LOGGED_IN:"login::userLoggedIn",USER_LOGGED_OUT:"login::userLoggedOut"})}(window,window.angular);
//# sourceMappingURL=mkl-login-jwt.min.js.map